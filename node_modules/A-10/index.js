global.http=require('http');
global.fs=require("fs");
global.mime=require("../../app/Config/mime.js");
global.config=require("../../app/Config/config.js");
global.rt_web=require("../../app/Config/routing-web.js");
global.errors=require("./error.js");

require("./Controller.js");

module.exports ={

	listen:function(port){

		var routes=require("./routes.js");
		var publics=require("./publics.js");

		var server = global.http.createServer(function(request, response){

			var routing=routes.check(request.url);

			if(routing){
				console.log(routing);

				if(routing.controller){

					try{
						global.fs.statSync("./app/Controller/"+routing.controller+"_Controller.js");

						require("../../app/Controller/"+routing.controller+"_Controller.js");
						var controller=new routing.controller+"_Controller"();
						controller[routing.action]();


					}catch(err){

						console.log(err);
				        response.writeHead(200, {'Content-Type': 'text/html'});
				        response.write('<!DOCTYPE html>');
				        response.write('<html lang="ja">');
				        response.write('Hellow A-10!');
				        response.write('</html>');
				        response.end();

					}
				}

			}
			else if(publics.check(request.url)){
				publics.load(request.url,response);
			}
			else
			{
		        response.writeHead(404, {'Content-Type': 'text/html'});
		        response.end();
			}


	    }).listen(port);
	}

};